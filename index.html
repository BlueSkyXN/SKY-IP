<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPåœ°ç†ä½ç½®æŸ¥è¯¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .search-form {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 300px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #667eea;
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            margin-top: 30px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .result-title::before {
            content: "ğŸ“";
            margin-right: 10px;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .info-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 1.1em;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #ffe6e6;
            color: #cc0000;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #cc0000;
        }

        .city-info {
            margin-top: 20px;
        }

        .city-info .result-title::before {
            content: "ğŸ™ï¸";
        }

        /* Enhanced result cards */
        .result-card.enhanced {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 1px solid #e3e6ea;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .result-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: -25px -25px 20px -25px;
        }

        .result-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .result-title .flag {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .result-title .title-text {
            flex: 1;
        }

        .ip-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
            font-weight: normal;
        }

        .badges {
            display: flex;
            gap: 8px;
        }

        .status-badge, .foreign-badge, .domestic-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-badge.open {
            background: #28a745;
            color: white;
        }

        .status-badge.closed {
            background: #dc3545;
            color: white;
        }

        .foreign-badge {
            background: #ffc107;
            color: #212529;
        }

        .domestic-badge {
            background: #17a2b8;
            color: white;
        }

        .location-summary {
            margin-top: 15px;
        }

        .location-path {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            font-size: 1.1em;
        }

        .location-path .separator {
            opacity: 0.7;
            margin: 0 5px;
        }

        .location-path .country {
            font-weight: bold;
        }

        .location-path .province,
        .location-path .city,
        .location-path .district {
            opacity: 0.9;
        }

        .city-main-info {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .city-name {
            font-size: 1.2em;
            font-weight: bold;
        }

        .city-pinyin {
            font-size: 0.9em;
            opacity: 0.8;
            font-style: italic;
        }

        .result-details {
            margin-top: 0;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1em;
            font-weight: bold;
            color: #495057;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e9ecef;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 8px;
        }

        /* å¤§å±å¹•ä¼˜åŒ– - æ˜¾ç¤ºæ›´å¤šåˆ— */
        @media (min-width: 1200px) {
            .info-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }

        @media (min-width: 992px) and (max-width: 1199px) {
            .info-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        .info-item.compact {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 8px 10px;
            transition: all 0.3s ease;
        }

        .info-item.compact:hover {
            background: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .info-item.compact .info-label {
            font-size: 0.75em;
            color: #6c757d;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
        }

        .info-item.compact .info-value {
            font-size: 0.9em;
            color: #212529;
            font-weight: 500;
            line-height: 1.2;
        }

        .info-value.coordinates {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        /* Loading animation enhancement */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .loading::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error message enhancement */
        .error {
            background: linear-gradient(135deg, #ffe6e6 0%, #ffcccc 100%);
            color: #cc0000;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #cc0000;
            box-shadow: 0 4px 15px rgba(204, 0, 0, 0.1);
        }

        /* Raw data display */
        .raw-data-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            margin-top: 20px;
            background: transparent;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
        }

        .raw-data-toggle:hover {
            background: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }

        .raw-data-toggle .icon {
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }

        .raw-data-toggle.expanded .icon {
            transform: rotate(180deg);
        }

        .raw-data-panel {
            margin-top: 15px;
            border-radius: 8px;
            background: #1e1e1e;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 0;
            transition: max-height 0.3s ease;
        }

        .raw-data-panel.expanded {
            max-height: 500px;
        }

        .raw-data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #2d2d2d;
            border-bottom: 1px solid #404040;
        }

        .raw-data-title {
            color: #ffffff;
            font-size: 0.9em;
            font-weight: 600;
            margin: 0;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
        }

        .copy-btn:hover {
            background: #5a6fd8;
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .raw-data-content {
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', 'Monaco', monospace;
            font-size: 0.85em;
            line-height: 1.4;
            color: #ffffff;
        }

        .raw-data-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* JSON syntax highlighting */
        .json-key {
            color: #9cdcfe;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        .json-boolean {
            color: #569cd6;
        }

        .json-null {
            color: #569cd6;
        }

        .json-punctuation {
            color: #d4d4d4;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .result-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .location-path {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .location-path .separator {
                display: none;
            }

            .raw-data-panel.expanded {
                max-height: 300px;
            }

            .raw-data-content {
                font-size: 0.8em;
                padding: 12px;
            }
        }

        .proxy-mode-selector {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
        }

        .proxy-mode-selector h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2em;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .mode-btn:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .mode-info {
            margin-top: 15px;
        }

        .mode-description {
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            font-size: 14px;
            line-height: 1.5;
        }

        .cors-proxy-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border: 1px solid #ffc107;
        }

        .cors-proxy-selector h4 {
            margin-bottom: 10px;
            color: #856404;
        }

        .proxy-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .proxy-options label {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            background: white;
            border-radius: 20px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .proxy-options label:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .proxy-options input[type="radio"] {
            margin-right: 8px;
        }

        @media (max-width: 600px) {
            .search-form {
                flex-direction: column;
            }
            
            .input-group {
                min-width: 100%;
            }
            
            .container {
                padding: 20px;
            }

            .mode-buttons {
                flex-direction: column;
            }

            .mode-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>IPåœ°ç†ä½ç½®æŸ¥è¯¢</h1>
            <p>åŸºäºç¾å›¢API <a href="https://www.nodeseek.com/post-325992-1" target="_blank">https://www.nodeseek.com/post-325992-1</a></p>
        </div>

        <div class="proxy-mode-selector" id="proxyModeSelector">
            <h3>é€‰æ‹©ä»£ç†æ¨¡å¼</h3>
            <div class="mode-buttons">
                <button type="button" class="mode-btn active" data-mode="cors">CORSä»£ç†</button>
                <button type="button" class="mode-btn" data-mode="node">Nodeä»£ç†</button>
            </div>
            <div class="mode-info">
                <div class="mode-description" id="corsMode" style="display: none;">
                    <strong>CORSä»£ç†æ¨¡å¼:</strong> ä½¿ç”¨å…¬å…±ä»£ç†æœåŠ¡ï¼Œæ— éœ€æœ¬åœ°æœåŠ¡å™¨ï¼Œä½†å¯èƒ½ä¸ç¨³å®š
                </div>
                <div class="mode-description" id="nodeMode">
                    <strong>Nodeä»£ç†æ¨¡å¼:</strong> ä½¿ç”¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨ï¼Œç¨³å®šå¯é ï¼Œéœ€è¦è¿è¡Œ <code>npm start</code>
                </div>
            </div>
        </div>

        <div class="cors-proxy-selector" id="corsProxySelector" style="display: none;">
            <h4>CORSä»£ç†æœåŠ¡</h4>
            <div class="proxy-options">
                <label><input type="radio" name="corsProxy" value="allorigins" checked> AllOrigins Raw</label>
            </div>
        </div>

        <form class="search-form" id="searchForm">
            <div class="input-group">
                <input type="text" id="ipInput" placeholder="è¯·è¾“å…¥IPåœ°å€ (ä¾‹å¦‚: 1.1.1.1)" required>
            </div>
            <button type="submit" class="search-btn" id="searchBtn">æŸ¥è¯¢</button>
        </form>

        <div class="results" id="results"></div>
    </div>

    <script>
        // ä»£ç†é…ç½®
        const PROXY_CONFIG = {
            node: {
                ip: `${window.location.origin}/api/ip`,
                city: `${window.location.origin}/api/city`
            },
            cors: {
                allorigins: 'https://api.allorigins.win/raw?url='
            }
        };

        const MEITUAN_API = {
            ip: 'https://apimobile.meituan.com/locate/v2/ip/loc',
            city: 'https://apimobile.meituan.com/group/v1/city/latlng'
        };

        // DOMå…ƒç´ 
        const form = document.getElementById('searchForm');
        const ipInput = document.getElementById('ipInput');
        const searchBtn = document.getElementById('searchBtn');
        const results = document.getElementById('results');
        const proxyModeSelector = document.getElementById('proxyModeSelector');
        const corsProxySelector = document.getElementById('corsProxySelector');

        // å½“å‰æ¨¡å¼
        let currentMode = 'node';
        
        // å­˜å‚¨åŸå§‹æ•°æ®
        let rawIPData = null;
        let rawCityData = null;

        // æ¨¡å¼åˆ‡æ¢äº‹ä»¶
        proxyModeSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('mode-btn')) {
                const mode = e.target.dataset.mode;
                switchMode(mode);
            }
        });

        function switchMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // æ›´æ–°æè¿°
            document.getElementById('nodeMode').style.display = mode === 'node' ? 'block' : 'none';
            document.getElementById('corsMode').style.display = mode === 'cors' ? 'block' : 'none';
            
            // æ˜¾ç¤º/éšè—CORSä»£ç†é€‰æ‹©å™¨
            corsProxySelector.style.display = mode === 'cors' ? 'block' : 'none';
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const ip = ipInput.value.trim();
            
            if (!ip) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„IPåœ°å€');
                return;
            }

            if (!isValidIP(ip)) {
                showError('è¯·è¾“å…¥æ­£ç¡®æ ¼å¼çš„IPåœ°å€');
                return;
            }

            await queryIPLocation(ip);
        });

        function isValidIP(ip) {
            const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            return ipRegex.test(ip);
        }

        async function queryIPLocation(ip) {
            try {
                setLoading(true);
                
                let data;
                
                if (currentMode === 'node') {
                    // Node.js ä»£ç†æ¨¡å¼
                    data = await queryWithNodeProxy(ip);
                } else {
                    // CORS ä»£ç†æ¨¡å¼
                    data = await queryWithCorsProxy(ip);
                }
                
                if (data && data.data) {
                    // ä¿å­˜åŸå§‹æ•°æ®
                    rawIPData = data;
                    showIPResult(data.data);
                    
                    // å¦‚æœæœ‰ç»çº¬åº¦ä¿¡æ¯ï¼ŒæŸ¥è¯¢åŸå¸‚è¯¦æƒ…
                    if (data.data.lat && data.data.lng) {
                        await queryCityInfo(data.data.lat, data.data.lng);
                    }
                } else {
                    showError('æœªæ‰¾åˆ°è¯¥IPçš„åœ°ç†ä½ç½®ä¿¡æ¯');
                }
            } catch (error) {
                console.error('æŸ¥è¯¢å¤±è´¥:', error);
                showError(`æŸ¥è¯¢å¤±è´¥: ${error.message}`);
            } finally {
                setLoading(false);
            }
        }

        async function queryWithNodeProxy(ip) {
            const response = await fetch(`${PROXY_CONFIG.node.ip}/${ip}`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return await response.json();
        }

        async function queryWithCorsProxy(ip) {
            const proxyUrl = PROXY_CONFIG.cors.allorigins;
            const targetUrl = `${MEITUAN_API.ip}?rgeo=true&ip=${ip}`;
            
            const response = await fetch(`${proxyUrl}${encodeURIComponent(targetUrl)}`);
            return await response.json();
        }

        async function queryCityInfo(lat, lng) {
            try {
                let data;
                
                if (currentMode === 'node') {
                    // Node.js ä»£ç†æ¨¡å¼
                    const response = await fetch(`${PROXY_CONFIG.node.city}/${lat}/${lng}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    data = await response.json();
                } else {
                    // CORS ä»£ç†æ¨¡å¼
                    const proxyUrl = PROXY_CONFIG.cors.allorigins;
                    const targetUrl = `${MEITUAN_API.city}/${lat},${lng}?tag=0`;
                    
                    const response = await fetch(`${proxyUrl}${encodeURIComponent(targetUrl)}`);
                    data = await response.json();
                }
                
                if (data && data.data) {
                    // ä¿å­˜åŸå§‹æ•°æ®
                    rawCityData = data;
                    showCityResult(data.data);
                }
            } catch (error) {
                console.error('åŸå¸‚ä¿¡æ¯æŸ¥è¯¢å¤±è´¥:', error);
                showError(`åŸå¸‚ä¿¡æ¯æŸ¥è¯¢å¤±è´¥: ${error.message}`);
            }
        }

        function showIPResult(data) {
            const flag = getCountryFlag(data.rgeo?.country);
            const coordinates = data.lat && data.lng ? `${data.lat}, ${data.lng}` : 'æœªçŸ¥';
            
            const resultHTML = `
                <div class="result-card enhanced">
                    <div class="result-header">
                        <div class="result-title">
                            <span class="flag">${flag}</span>
                            <span class="title-text">IPåœ°ç†ä½ç½®ä¿¡æ¯</span>
                            <span class="ip-badge">${data.ip || 'æœªçŸ¥'}</span>
                        </div>
                        <div class="location-summary">
                            <div class="location-path">
                                <span class="country">${data.rgeo?.country || 'æœªçŸ¥'}</span>
                                ${data.rgeo?.province ? `<span class="separator">></span><span class="province">${data.rgeo.province}</span>` : ''}
                                ${data.rgeo?.city ? `<span class="separator">></span><span class="city">${data.rgeo.city}</span>` : ''}
                                ${data.rgeo?.district ? `<span class="separator">></span><span class="district">${data.rgeo.district}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-details">
                        <div class="detail-section">
                            <div class="section-title">ğŸ“ åœ°ç†ä½ç½®</div>
                            <div class="info-grid">
                                <div class="info-item compact">
                                    <div class="info-label">å›½å®¶</div>
                                    <div class="info-value">${flag} ${data.rgeo?.country || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">çœä»½</div>
                                    <div class="info-value">${data.rgeo?.province || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŸå¸‚</div>
                                    <div class="info-value">${data.rgeo?.city || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŒºåŸŸ</div>
                                    <div class="info-value">${data.rgeo?.district || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŒºåŸŸä»£ç </div>
                                    <div class="info-value">${data.rgeo?.adcode || 'æœªçŸ¥'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-title">ğŸŒ æŠ€æœ¯ä¿¡æ¯</div>
                            <div class="info-grid">
                                <div class="info-item compact">
                                    <div class="info-label">åæ ‡</div>
                                    <div class="info-value coordinates">${coordinates}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">ç»åº¦</div>
                                    <div class="info-value coordinates">${data.lng || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">çº¬åº¦</div>
                                    <div class="info-value coordinates">${data.lat || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">æ•°æ®æº</div>
                                    <div class="info-value">${data.fromwhere || 'æœªçŸ¥'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="raw-data-toggle" onclick="toggleRawData('ip')">
                        <span class="icon">â–¼</span>
                        <span class="text">æŸ¥çœ‹åŸå§‹æ•°æ®</span>
                    </button>
                    
                    <div class="raw-data-panel" id="ipRawData">
                        <div class="raw-data-header">
                            <h4 class="raw-data-title">IPæŸ¥è¯¢åŸå§‹æ•°æ®</h4>
                            <button class="copy-btn" onclick="copyToClipboard('ip')">å¤åˆ¶</button>
                        </div>
                        <div class="raw-data-content">
                            <pre id="ipRawContent">${formatJSON(rawIPData)}</pre>
                        </div>
                    </div>
                </div>
            `;
            
            results.innerHTML = resultHTML;
        }

        function showCityResult(data) {
            const flag = getCountryFlag(data.country);
            const statusBadge = data.isOpen ? 
                '<span class="status-badge open">å¼€æ”¾</span>' : 
                '<span class="status-badge closed">æœªå¼€æ”¾</span>';
            const foreignBadge = data.isForeign ? 
                '<span class="foreign-badge">æµ·å¤–</span>' : 
                '<span class="domestic-badge">å›½å†…</span>';
            
            const cityResultHTML = `
                <div class="result-card enhanced city-info">
                    <div class="result-header">
                        <div class="result-title">
                            <span class="flag">${flag}</span>
                            <span class="title-text">åŸå¸‚è¯¦ç»†ä¿¡æ¯</span>
                            <div class="badges">
                                ${statusBadge}
                                ${foreignBadge}
                            </div>
                        </div>
                        <div class="location-summary">
                            <div class="city-main-info">
                                <div class="city-name">${data.city || 'æœªçŸ¥'}</div>
                                <div class="city-pinyin">${data.cityPinyin || ''}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-details">
                        <div class="detail-section">
                            <div class="section-title">ğŸ™ï¸ åŸå¸‚ä¿¡æ¯</div>
                            <div class="info-grid">
                                <div class="info-item compact">
                                    <div class="info-label">åŸå¸‚åç§°</div>
                                    <div class="info-value">${data.city || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">å¼€æ”¾åŸå¸‚</div>
                                    <div class="info-value">${data.openCityName || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŸå¸‚æ‹¼éŸ³</div>
                                    <div class="info-value">${data.cityPinyin || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">çœä»½</div>
                                    <div class="info-value">${data.province || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŒºåŸŸ</div>
                                    <div class="info-value">${data.district || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">è¯¦ç»†åœ°å€</div>
                                    <div class="info-value">${data.detail || 'æœªçŸ¥'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="section-title">ğŸ”¢ ç³»ç»Ÿä¿¡æ¯</div>
                            <div class="info-grid">
                                <div class="info-item compact">
                                    <div class="info-label">åŸå¸‚ID</div>
                                    <div class="info-value">${data.id || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">DPåŸå¸‚ID</div>
                                    <div class="info-value">${data.dpCityId || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŸå§‹åŸå¸‚ID</div>
                                    <div class="info-value">${data.originCityID || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŒºåŸŸä»£ç </div>
                                    <div class="info-value">${data.area || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">çˆ¶åŒºåŸŸ</div>
                                    <div class="info-value">${data.parentArea || 'æœªçŸ¥'}</div>
                                </div>
                                <div class="info-item compact">
                                    <div class="info-label">åŒºåŸŸåç§°</div>
                                    <div class="info-value">${data.areaName || 'æœªçŸ¥'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="raw-data-toggle" onclick="toggleRawData('city')">
                        <span class="icon">â–¼</span>
                        <span class="text">æŸ¥çœ‹åŸå§‹æ•°æ®</span>
                    </button>
                    
                    <div class="raw-data-panel" id="cityRawData">
                        <div class="raw-data-header">
                            <h4 class="raw-data-title">åŸå¸‚æŸ¥è¯¢åŸå§‹æ•°æ®</h4>
                            <button class="copy-btn" onclick="copyToClipboard('city')">å¤åˆ¶</button>
                        </div>
                        <div class="raw-data-content">
                            <pre id="cityRawContent">${formatJSON(rawCityData)}</pre>
                        </div>
                    </div>
                </div>
            `;
            
            results.innerHTML += cityResultHTML;
        }

        function getCountryFlag(country) {
            const flags = {
                'ä¸­å›½': 'ğŸ‡¨ğŸ‡³',
                'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
                'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ',
                'éŸ©å›½': 'ğŸ‡°ğŸ‡·',
                'è‹±å›½': 'ğŸ‡¬ğŸ‡§',
                'æ³•å›½': 'ğŸ‡«ğŸ‡·',
                'å¾·å›½': 'ğŸ‡©ğŸ‡ª',
                'åŠ æ‹¿å¤§': 'ğŸ‡¨ğŸ‡¦',
                'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º',
                'ä¿„ç½—æ–¯': 'ğŸ‡·ğŸ‡º',
                'å°åº¦': 'ğŸ‡®ğŸ‡³',
                'æ–°åŠ å¡': 'ğŸ‡¸ğŸ‡¬',
                'é¦™æ¸¯': 'ğŸ‡­ğŸ‡°',
                'å°æ¹¾': 'ğŸ‡¹ğŸ‡¼',
                'åŸƒåŠ': 'ğŸ‡ªğŸ‡¬'
            };
            return flags[country] || 'ğŸ³ï¸';
        }

        function showError(message) {
            results.innerHTML = `<div class="error">âŒ ${message}</div>`;
        }

        function setLoading(loading) {
            if (loading) {
                searchBtn.disabled = true;
                searchBtn.textContent = 'æŸ¥è¯¢ä¸­...';
                results.innerHTML = '<div class="loading">ğŸ” æ­£åœ¨æŸ¥è¯¢ä¸­...</div>';
            } else {
                searchBtn.disabled = false;
                searchBtn.textContent = 'æŸ¥è¯¢';
            }
        }

        // ç¤ºä¾‹IPåœ°å€å¿«æ·æŒ‰é’®
        const exampleIPs = ['1.1.1.1', '8.8.8.8', '114.114.114.114'];
        const exampleButtons = exampleIPs.map(ip => 
            `<button type="button" onclick="ipInput.value='${ip}'" style="margin: 5px; padding: 5px 10px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">${ip}</button>`
        ).join('');

        // åœ¨è¡¨å•åæ·»åŠ ç¤ºä¾‹æŒ‰é’®
        form.insertAdjacentHTML('afterend', `
            <div style="text-align: center; margin-bottom: 20px;">
                <p style="color: #666; margin-bottom: 10px;">å¿«é€Ÿæµ‹è¯•:</p>
                ${exampleButtons}
            </div>
        `);

        // åŸå§‹æ•°æ®ç›¸å…³åŠŸèƒ½
        function formatJSON(data) {
            if (!data) return 'æš‚æ— æ•°æ®';
            
            try {
                const jsonString = JSON.stringify(data, null, 2);
                return syntaxHighlight(jsonString);
            } catch (e) {
                return 'æ•°æ®æ ¼å¼é”™è¯¯';
            }
        }

        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                var cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function toggleRawData(type) {
            const panel = document.getElementById(type + 'RawData');
            const toggle = panel.previousElementSibling;
            const icon = toggle.querySelector('.icon');
            const text = toggle.querySelector('.text');
            
            if (panel.classList.contains('expanded')) {
                // æ”¶èµ·
                panel.classList.remove('expanded');
                toggle.classList.remove('expanded');
                icon.style.transform = 'rotate(0deg)';
                text.textContent = 'æŸ¥çœ‹åŸå§‹æ•°æ®';
            } else {
                // å±•å¼€
                panel.classList.add('expanded');
                toggle.classList.add('expanded');
                icon.style.transform = 'rotate(180deg)';
                text.textContent = 'éšè—åŸå§‹æ•°æ®';
                
                // æ›´æ–°å†…å®¹
                const content = document.getElementById(type + 'RawContent');
                const rawData = type === 'ip' ? rawIPData : rawCityData;
                content.innerHTML = formatJSON(rawData);
            }
        }

        function copyToClipboard(type) {
            const rawData = type === 'ip' ? rawIPData : rawCityData;
            const jsonString = JSON.stringify(rawData, null, 2);
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(jsonString).then(() => {
                    showCopySuccess(type);
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(jsonString, type);
                });
            } else {
                fallbackCopyTextToClipboard(jsonString, type);
            }
        }

        function fallbackCopyTextToClipboard(text, type) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess(type);
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopySuccess(type) {
            const copyBtn = document.querySelector(`#${type}RawData .copy-btn`);
            const originalText = copyBtn.textContent;
            
            copyBtn.textContent = 'å·²å¤åˆ¶';
            copyBtn.classList.add('copied');
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        }
    </script>
</body>
</html>